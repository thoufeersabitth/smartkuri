{% extends "chitti/group_admin_base.html" %}
{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'group_admin/css/add_group.css' %}">
{% endblock %}

{% block content %}
<div class="container mt-4">

    <h2>Add Group</h2>

    {# ---------------- MESSAGES ---------------- #}
    {% if messages %}
        <div class="mt-3">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    {# ---------------- SUBSCRIPTION STATUS ---------------- #}
    {% if not subscription %}
        <div class="alert alert-danger">
            <strong>Subscription Expired ðŸ”´</strong><br>
            Please renew to create new groups.
        </div>
    {% else %}
        <div class="alert alert-info">
            <strong>Plan:</strong> {{ plan.name }}<br>
            <strong>Max Groups:</strong> {{ plan.max_groups }}<br>
            <strong>Remaining:</strong> {{ remaining_groups }}
        </div>
    {% endif %}

    {% if subscription and remaining_groups <= 0 %}
        <div class="alert alert-warning">
            You have reached your group creation limit for this plan.
        </div>
    {% endif %}

    {# ---------------- CREATE FORM ---------------- #}
    <form method="post" class="form-container mt-3">
        {% csrf_token %}

        <div class="form-group mb-3">
            <label for="name">Group Name</label>
            <input type="text" name="name" id="name" class="form-control"
                   placeholder="Enter group name"
                   required {% if remaining_groups <= 0 or not subscription %}disabled{% endif %}>
        </div>

        <div class="form-group mb-3">
            <label for="monthly_amount">Monthly Amount</label>
            <input type="number" step="0.01" name="monthly_amount" id="monthly_amount"
                   class="form-control" placeholder="â‚¹0.00"
                   required {% if remaining_groups <= 0 or not subscription %}disabled{% endif %}>
        </div>

        <div class="form-group mb-3">
            <label for="duration_months">Duration (Months)</label>
            <input type="number" name="duration_months" id="duration_months"
                   class="form-control" placeholder="e.g. 12"
                   required {% if remaining_groups <= 0 or not subscription %}disabled{% endif %}>
        </div>

        <div class="form-group mb-4">
            <label for="start_date">Start Date</label>
            <input type="date" name="start_date" id="start_date"
                   class="form-control"
                   required {% if remaining_groups <= 0 or not subscription %}disabled{% endif %}>
        </div>

        {# ---------------- BUTTONS ---------------- #}
        <div class="form-actions">
            <button type="submit" class="btn btn-success"
                    {% if remaining_groups <= 0 or not subscription %}disabled{% endif %}>
                Create Group
            </button>

            <a href="{% url 'chitti:group_management' %}" class="btn btn-secondary ms-2">
                Cancel
            </a>

            {% if not subscription or remaining_groups <= 0 %}
                <a href="{% url 'subscriptions:renew_subscription' %}" class="btn btn-primary ms-2">
                    Renew / Upgrade Plan
                </a>
            {% endif %}
        </div>
    </form>
</div>
{% endblock %}
