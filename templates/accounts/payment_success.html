{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Successful - SmartKuri</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'accounts/css/payment_success.css' %}">
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="{% static 'accounts/images/favicon.ico' %}" type="image/x-icon">
</head>
<body>
    <!-- Confetti Animation -->
    <div id="confetti-container"></div>

    <div class="success-wrapper">
        <!-- Success Card -->
        <div class="success-card">
            <!-- Success Icon with Animation -->
            <div class="success-icon-container">
                <div class="success-circle">
                    <i class="bi bi-check-circle-fill"></i>
                </div>
                <div class="success-pulse"></div>
                <div class="success-pulse delay-1"></div>
                <div class="success-pulse delay-2"></div>
            </div>

            <!-- Success Message -->
            <h1 class="success-title">Payment Successful!</h1>
            <p class="success-subtitle">Congratulations! Your group has been created successfully.</p>

            <!-- Order Details -->
            <div class="order-details-card">
                <div class="detail-header">
                    <i class="bi bi-receipt me-2"></i>
                    <h3>Order Details</h3>
                </div>
                
                <div class="details-grid">
                    <div class="detail-item">
                        <span class="detail-label">Group Name</span>
                        <span class="detail-value">{{ group_name }}</span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">Transaction ID</span>
                        <span class="detail-value transaction-id">{{ payment_id|default:"PYMNT12345" }}</span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">Date & Time</span>
                        <span class="detail-value">{{ payment_date|date:"F d, Y h:i A"|default:"Just now" }}</span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">Amount Paid</span>
                        <span class="detail-value amount">{{ amount_paid|default:"‚Çπ0" }}</span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">Payment Method</span>
                        <span class="detail-value">
                            <i class="bi bi-credit-card me-1"></i>
                            {{ payment_method|default:"Razorpay" }}
                        </span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-label">Status</span>
                        <span class="detail-value status-badge">
                            <i class="bi bi-check-circle-fill me-1"></i>
                            Completed
                        </span>
                    </div>
                </div>
            </div>

            <!-- Next Steps -->
            <div class="next-steps">
                <h4><i class="bi bi-rocket-takeoff me-2"></i> What's Next?</h4>
                <div class="steps-list">
                    <div class="step">
                        <div class="step-icon">
                            <i class="bi bi-person-plus"></i>
                        </div>
                        <div class="step-content">
                            <h5>Invite Members</h5>
                            <p>Start adding members to your group from the dashboard</p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-icon">
                            <i class="bi bi-gear"></i>
                        </div>
                        <div class="step-content">
                            <h5>Customize Settings</h5>
                            <p>Configure your group preferences and permissions</p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-icon">
                            <i class="bi bi-bar-chart"></i>
                        </div>
                        <div class="step-content">
                            <h5>Explore Features</h5>
                            <p>Discover all the features included in your plan</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <a href="{% url 'accounts:login' %}" class="btn btn-primary btn-lg">
                    <i class="bi bi-box-arrow-in-right me-2"></i>
                    Go to Dashboard
                </a>
                
                <a href="{% url 'accounts:group_details' group_id %}" class="btn btn-outline-primary btn-lg">
                    <i class="bi bi-eye me-2"></i>
                    View Group
                </a>
                
                <button id="download-receipt" class="btn btn-outline-success btn-lg">
                    <i class="bi bi-download me-2"></i>
                    Download Receipt
                </button>
            </div>

            <!-- Share Success -->
            <div class="share-section">
                <p class="share-text">Share your success!</p>
                <div class="social-icons">
                    <button class="social-btn twitter">
                        <i class="bi bi-twitter"></i>
                    </button>
                    <button class="social-btn facebook">
                        <i class="bi bi-facebook"></i>
                    </button>
                    <button class="social-btn linkedin">
                        <i class="bi bi-linkedin"></i>
                    </button>
                    <button class="social-btn whatsapp">
                        <i class="bi bi-whatsapp"></i>
                    </button>
                </div>
            </div>

            <!-- Support Info -->
            <div class="support-info">
                <p>
                    <i class="bi bi-question-circle me-2"></i>
                    Need help? <a href="#">Contact Support</a> or check our <a href="#">FAQ</a>
                </p>
                <p class="text-muted small">
                    <i class="bi bi-shield-check me-1"></i>
                    Your payment is secured and encrypted. Invoice will be emailed to you shortly.
                </p>
            </div>
        </div>

        <!-- Celebration Message -->
        <div class="celebration-message">
            <div class="firework"></div>
            <div class="firework"></div>
            <div class="firework"></div>
            <p>üéâ Welcome to SmartKuri Premium! üéâ</p>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // payment_success.js
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéâ Payment Success Page Loaded');
            
            // Initialize all features
            initializeConfetti();
            initializeButtons();
            initializeSocialShare();
            initializeAutoRedirect();
            addCelebrationEffects();
            initializePageAnalytics();
            
            // Add keyboard shortcuts
            initializeKeyboardShortcuts();
            
            // Celebrate with sound (optional)
            playCelebrationSound();
        });

        // =================== CONFETTI EFFECT ===================
        function initializeConfetti() {
            console.log('Creating confetti...');
            const colors = [
                '#4361ee', '#3a0ca3', '#7209b7', '#4cc9f0', 
                '#f72585', '#f8961e', '#28a745', '#20c997'
            ];
            
            const confettiContainer = document.getElementById('confetti-container');
            if (!confettiContainer) return;
            
            // Create confetti pieces
            for (let i = 0; i < 200; i++) {
                createConfettiPiece(confettiContainer, colors);
            }
            
            // Add continuous confetti
            setInterval(() => {
                createConfettiPiece(confettiContainer, colors);
            }, 500);
        }

        function createConfettiPiece(container, colors) {
            const confetti = document.createElement('div');
            const size = Math.random() * 10 + 5;
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            // Style confetti
            confetti.style.cssText = `
                position: absolute;
                width: ${size}px;
                height: ${size}px;
                background: ${color};
                border-radius: ${Math.random() > 0.7 ? '50%' : '2px'};
                left: ${Math.random() * 100}vw;
                top: -20px;
                opacity: ${Math.random() * 0.7 + 0.3};
                transform: rotate(${Math.random() * 360}deg);
                z-index: 1000;
            `;
            
            // Animation
            const animation = confetti.animate([
                { 
                    transform: `translateY(0) rotate(0deg)`,
                    opacity: 0.8 
                },
                { 
                    transform: `translateY(${window.innerHeight + 100}px) rotate(${Math.random() * 720}deg)`,
                    opacity: 0 
                }
            ], {
                duration: Math.random() * 4000 + 2000,
                easing: 'cubic-bezier(0.215, 0.61, 0.355, 1)',
                delay: Math.random() * 1000
            });
            
            container.appendChild(confetti);
            
            // Remove after animation
            animation.onfinish = () => {
                if (confetti.parentNode) {
                    confetti.remove();
                }
            };
        }

        // =================== BUTTON FUNCTIONALITY ===================
        function initializeButtons() {
            // Download Receipt Button
            const downloadBtn = document.getElementById('download-receipt');
            if (downloadBtn) {
                downloadBtn.addEventListener('click', generateReceipt);
            }
            
            // Add hover effects to all buttons
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(btn => {
                btn.addEventListener('mouseenter', () => {
                    btn.style.transform = 'translateY(-3px)';
                });
                
                btn.addEventListener('mouseleave', () => {
                    btn.style.transform = 'translateY(0)';
                });
                
                btn.addEventListener('click', function() {
                    // Add click animation
                    this.style.transform = 'scale(0.98)';
                    setTimeout(() => {
                        this.style.transform = 'scale(1)';
                    }, 150);
                });
            });
        }

        function generateReceipt() {
            const downloadBtn = document.getElementById('download-receipt');
            const originalText = downloadBtn.innerHTML;
            
            // Show loading state
            downloadBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i> Generating...';
            downloadBtn.disabled = true;
            
            // Simulate API call
            setTimeout(() => {
                // Create receipt data
                const receiptData = createReceiptData();
                
                // Create and trigger download
                const blob = new Blob([receiptData.content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = receiptData.filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // Show success state
                downloadBtn.innerHTML = '<i class="bi bi-check-circle me-2"></i> Downloaded!';
                downloadBtn.classList.add('btn-success');
                downloadBtn.classList.remove('btn-outline-success');
                
                // Reset after 2 seconds
                setTimeout(() => {
                    downloadBtn.innerHTML = originalText;
                    downloadBtn.disabled = false;
                    downloadBtn.classList.remove('btn-success');
                    downloadBtn.classList.add('btn-outline-success');
                }, 2000);
                
            }, 1500);
        }

        function createReceiptData() {
            const groupName = document.querySelector('.detail-value').textContent;
            const transId = document.querySelector('.transaction-id').textContent;
            const date = document.querySelector('.detail-item:nth-child(3) .detail-value').textContent;
            const amount = document.querySelector('.amount').textContent;
            const method = document.querySelector('.detail-item:nth-child(5) .detail-value').textContent;
            
            const content = `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë              SMARTKURI - PAYMENT RECEIPT         ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üìã ORDER DETAILS
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚Ä¢ Group Name      : ${groupName}
‚Ä¢ Transaction ID  : ${transId}
‚Ä¢ Date & Time     : ${date}
‚Ä¢ Amount Paid     : ${amount}
‚Ä¢ Payment Method  : ${method}
‚Ä¢ Status          : ‚úÖ Completed

üí∞ PAYMENT SUMMARY
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚Ä¢ Subtotal        : ${amount}
‚Ä¢ Tax             : ‚Çπ0.00
‚Ä¢ Discount        : ‚Çπ0.00
‚Ä¢ Total Paid      : ${amount}

üìß CONTACT INFORMATION
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚Ä¢ For any queries, contact: support@smartkuri.com
‚Ä¢ Visit: https://smartkuri.com

üìù TERMS & CONDITIONS
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚Ä¢ This is an electronically generated receipt.
‚Ä¢ Please retain this receipt for your records.
‚Ä¢ Valid for tax purposes.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            Thank you for choosing SmartKuri! üéâ
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            `;
            
            const filename = `SmartKuri_Receipt_${transId}_${Date.now()}.txt`;
            
            return { content, filename };
        }

        // =================== SOCIAL SHARE ===================
        function initializeSocialShare() {
            const socialButtons = document.querySelectorAll('.social-btn');
            socialButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const platform = this.classList[1];
                    shareOnSocial(platform);
                });
            });
        }

        function shareOnSocial(platform) {
            const groupName = document.querySelector('.detail-value').textContent;
            const shareText = `üéâ I just created my group "${groupName}" on SmartKuri! Ready to manage things smarter.`;
            const shareUrl = window.location.href;
            
            let shareLink = '';
            
            switch(platform) {
                case 'twitter':
                    shareLink = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(shareUrl)}&hashtags=SmartKuri,Productivity`;
                    break;
                case 'facebook':
                    shareLink = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}&quote=${encodeURIComponent(shareText)}`;
                    break;
                case 'linkedin':
                    shareLink = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(shareUrl)}`;
                    break;
                case 'whatsapp':
                    shareLink = `https://wa.me/?text=${encodeURIComponent(shareText + ' ' + shareUrl)}`;
                    break;
            }
            
            if (shareLink) {
                window.open(shareLink, '_blank', 'width=600,height=400');
                
                // Add click animation
                const btn = document.querySelector(`.${platform}`);
                if (btn) {
                    btn.style.transform = 'scale(0.9)';
                    setTimeout(() => {
                        btn.style.transform = 'scale(1)';
                    }, 200);
                }
            }
        }

        // =================== AUTO REDIRECT ===================
        function initializeAutoRedirect() {
            // Auto redirect to dashboard after 30 seconds
            setTimeout(() => {
                showRedirectNotification();
            }, 25000);
            
            setTimeout(() => {
                // window.location.href = "{% url 'accounts:login' %}";
                console.log('Auto-redirect triggered');
            }, 30000);
        }

        function showRedirectNotification() {
            const notification = document.createElement('div');
            notification.className = 'redirect-notification alert alert-info alert-dismissible fade show';
            notification.innerHTML = `
                <i class="bi bi-clock me-2"></i>
                You will be redirected to dashboard in 5 seconds...
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                max-width: 300px;
                animation: slideInRight 0.3s ease-out;
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // =================== CELEBRATION EFFECTS ===================
        function addCelebrationEffects() {
            // Add floating emojis
            const emojis = ['üéâ', '‚ú®', 'üöÄ', 'üí´', '‚≠ê', 'üèÜ', '‚úÖ', 'üéä'];
            
            for (let i = 0; i < 15; i++) {
                createFloatingEmoji(emojis[Math.floor(Math.random() * emojis.length)]);
            }
            
            // Add success sound notification
            if (Notification.permission === 'granted') {
                new Notification('Payment Successful!', {
                    body: `Your group "${document.querySelector('.detail-value').textContent}" is ready!`,
                    icon: '{% static "accounts/images/favicon.ico" %}'
                });
            }
        }

        function createFloatingEmoji(emoji) {
            const emojiElement = document.createElement('div');
            emojiElement.textContent = emoji;
            emojiElement.style.cssText = `
                position: fixed;
                font-size: ${Math.random() * 20 + 20}px;
                left: ${Math.random() * 100}vw;
                top: 100vh;
                z-index: 999;
                pointer-events: none;
                opacity: ${Math.random() * 0.5 + 0.5};
            `;
            
            document.body.appendChild(emojiElement);
            
            // Animation
            const animation = emojiElement.animate([
                { 
                    transform: 'translateY(0) rotate(0deg)',
                    opacity: 0.8 
                },
                { 
                    transform: `translateY(-${window.innerHeight + 100}px) rotate(${Math.random() * 360}deg)`,
                    opacity: 0 
                }
            ], {
                duration: Math.random() * 3000 + 2000,
                easing: 'cubic-bezier(0.215, 0.61, 0.355, 1)',
                delay: Math.random() * 2000
            });
            
            animation.onfinish = () => {
                if (emojiElement.parentNode) {
                    emojiElement.remove();
                }
            };
        }

        // =================== PAGE ANALYTICS ===================
        function initializePageAnalytics() {
            // Log page view
            console.log('Payment Success Page Viewed:', {
                groupName: "{{ group_name }}",
                amount: "{{ amount_paid }}",
                timestamp: new Date().toISOString()
            });
            
            // Send analytics event (simulated)
            setTimeout(() => {
                console.log('Analytics: Payment success event recorded');
            }, 1000);
        }

        // =================== KEYBOARD SHORTCUTS ===================
        function initializeKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // D - Download receipt
                if (e.key === 'd' || e.key === 'D') {
                    e.preventDefault();
                    document.getElementById('download-receipt')?.click();
                }
                
                // E - Go to dashboard
                if (e.key === 'e' || e.key === 'E') {
                    e.preventDefault();
                    document.querySelector('.btn-primary')?.click();
                }
                
                // ESC - Close all modals
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.style.display = 'none';
                    });
                }
                
                // Ctrl/Cmd + P - Print receipt
                if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                    e.preventDefault();
                    window.print();
                }
            });
        }

        // =================== CELEBRATION SOUND ===================
        function playCelebrationSound() {
            // Create subtle success sound using Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
                
            } catch (error) {
                console.log('Audio not supported:', error);
            }
        }

        // =================== UTILITY FUNCTIONS ===================
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Copied to clipboard!', 'success');
            }).catch(err => {
                console.error('Copy failed:', err);
            });
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast-alert alert alert-${type}`;
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 9999;
                animation: slideInUp 0.3s ease-out;
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Request notification permission
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // Network status monitoring
        window.addEventListener('online', function() {
            console.log('Network connection restored');
            showToast('Back online!', 'success');
        });

        window.addEventListener('offline', function() {
            console.log('Network connection lost');
            showToast('Connection lost. Please check your internet.', 'warning');
        });

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideInUp {
                from { transform: translateY(100%); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
            
            .toast-alert {
                padding: 10px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            }
            
            .redirect-notification {
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>